var LT;(()=>{"use strict";var e={};function t(e){return Array.from((new TextEncoder).encode(e),(e=>e.toString(16).padStart(2,"0"))).join("")}function n(e){const t=new Uint8Array(e.length/2);for(let n=0;n!==t.length;n++)t[n]=parseInt(e.substr(2*n,2),16);return(new TextDecoder).decode(t)}function s(e){let t=document.createElement("p");return t.innerHTML=e,t.textContent}function a(e){return e&&e.length>14?e.substring(0,7)+"..."+e.substring(e.length-4):e}(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);const i="$u_",o="$f_",l="$a_",r="ghostnet",d="KT1GNCBXPwMwLsETn6AUdRzFz4Esx15yLaLY",c="https://api."+r+".tzkt.io/v1/contracts/"+d,m=new beacon.DAppClient({name:"TwiTez",matrixNodes:["https://rpc.mumbainet.teztnets.xyz","https://mumbainet.ecadinfra.com"]}),g="username_min_length",u="username_max_length",y="name_min_length",p="name_max_length",f="msg_min_length",w="msg_max_length",v="edit_tweet_time",h=new Map([[g,3],[u,15],[y,3],[p,50],[f,1],[w,250],[v,36e5]]),E="-1";var b=new class{constructor(e){this.storage=e?window.localStorage:window.sessionStorage}set(e,t){e&&t&&this.storage.setItem(l+e,t)}get(e){return this.storage.getItem(l+e)}has(e){return!!this.storage.getItem(l+e)}delete(e){this.storage.removeItem(l+e)}clear(){}size(){}},I=new class{constructor(e){this.storage=e?window.localStorage:window.sessionStorage}set(e,t){t&&this.storage.setItem(o+e,JSON.stringify(Array.from(t)))}get(e){try{return new Set(JSON.parse(this.storage.getItem(o+e)))}catch(t){console.log("*** CACHE_GET ERROR: key="+o+e+" error="+t)}return null}has(e){return!!this.storage.getItem(o+e)}delete(e){this.storage.removeItem(o+e)}clear(){}size(){}},L=new class{constructor(e){this.storage=e?window.localStorage:window.sessionStorage,this.size=0}set(e,t){this.storage.setItem(i+e,JSON.stringify(t)),this.size++}get(e){try{return JSON.parse(this.storage.getItem(i+e))}catch(t){console.log("*** CACHE_GET ERROR: key="+i+e+" error="+t)}return null}has(e){return!!this.storage.getItem(i+e)}delete(e){this.storage.removeItem(i+e),this.size--}clear(){this.storage.clear(),this.size=0}size(){return this.size}},T=null;const R="the wallet is not connected",B="the user is not logged in";function N(){return!!T}function O(){return T&&L.has(T)}async function k(){let e=await m.getActiveAccount();return!!e&&(T=e.address,console.log("INFO connectCached(): old userAddress="+T),!0)}async function S(){if(await k(),!N())try{const e=await m.requestPermissions({network:{type:r}});T=e.address,console.log("INFO connect(): new userAddress="+T)}catch(e){console.log("ERROR connect(): "+JSON.stringify(e))}}async function A(){await m.removeAllAccounts(),T=null,L.clear()}async function _(e){if(e?await k():(await A(),await S()),!N())return void console.log("ERROR login(): "+R);let t=await U(T);console.log("INFO login(): user="+JSON.stringify(t))}async function M(e){if(e=e.toLowerCase(),console.log("INFO getAddress(): getting address for username="+e),b.has(e))console.log("INFO getAddress(): cached for username="+e+" address="+b.get(e));else try{let t=await fetch(c+"/bigmaps/dns/keys/"+e);if(t.ok){let n=await t.json();b.set(e,n.value),console.log("INFO getAddress(): loaded for username="+e+" address="+b.get(e))}else console.log("ERROR getAddress(): can't getting address for username="+e)}catch(e){console.log("ERROR getAddress(): "+JSON.stringify(e))}return b.get(e)}async function U(e){console.log("INFO getUser(): getting user for address="+e);let t=L.get(e);if(t)return t;try{let s=await fetch(c+"/bigmaps/users/keys/?key="+e+"&active=true&select=value");if(s.ok){let a=await s.json();if(console.log("INFO getUser(): json="+JSON.stringify(a)),a&&a.length>0){t={},t.address=e,t.username=a[0].username,t.reg_date=a[0].reg_date,t.pol_follow=a[0].pol_follow;let s=a[0].props.name;t.name=s?n(s):"",s=a[0].props.img,t.img=s?n(s):"",s=a[0].props.desc,t.desc=s?n(s):"",s=a[0].props.loc,t.location=s?n(s):"",s=a[0].props.twitter,t.twitter=s?n(s):"",s=a[0].props.web,t.website=s?n(s):"",e===T&&await H(e),b.set(t.username,t.address),L.set(t.address,t),console.log("INFO getUser(): loaded for address="+e+" user="+JSON.stringify(t))}else console.log("ERROR getUser(): there is no user for address="+e)}else console.log("ERROR getUser(): can't get user for address="+e)}catch(e){console.log("ERROR getUser(): "+e)}return console.log("INFO getUser(): user="+JSON.stringify(t)),t}async function P(e,t){console.log("INFO getTweet(): getting tweet for address="+e+" id="+t);try{let n=await fetch(c+"/bigmaps/tweets/keys/?key.a="+e+"&key.i="+t+"&active=true&select=value");if(n.ok){let e=await n.json();if(console.log("INFO getTweet(): tweet="+JSON.stringify(e)),e&&e.length>0)return e[0]}else console.log("ERROR getTweet(): can't get tweet for address="+e+" id="+t)}catch(e){console.log("ERRROR getTweet(): "+JSON.stringify(e))}return null}async function C(e){console.log("INFO getLikes(): getting likes for address="+e);try{let t=await fetch(c+"/bigmaps/likes/keys?active=true&select=value&key.user="+T+"&key.author="+e);if(t.ok){let e=await t.json();if(e&&e.length>0)return console.log("INFO getLikes(): likes="+JSON.stringify(e[0])),e[0]}else console.log("ERROR getLikes(): can't get likes for address="+e)}catch(e){console.log("ERRROR getLikes(): "+JSON.stringify(e))}return null}async function F(e,t){try{const n=await m.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:d,parameters:{entrypoint:"like",value:JSON.parse('{ "prim": "Pair", "args": [ { "int": "'+t+'" }, { "string": "'+e+'" } ] }')}}]});if(n.transactionHash)return n.transactionHash}catch(e){console.log("ERROR like(): "+JSON.stringify(e))}return!1}async function H(e){console.log("INFO getFollowings(): getting followings for address="+e);let t=null;if(e===T&&I.has(T))return I.get(T);try{let n=await fetch(c+"/bigmaps/followings/keys?active=true&select=value&key="+e);if(n.ok){let s=await n.json();console.log("INFO getFollowings(): followings for address="+e+" f="+JSON.stringify(s)),t=s&&s.length>0?new Set(Object.values(s[0])):new Set,e===T&&I.set(e,t)}else console.log("ERROR getFollowings(): can't get followings for address="+e)}catch(e){console.log("ERRROR getFollowings(): "+e)}return t}async function x(e){let t="";if(e.img)try{new URL(e.img),t=e.img.replace("ipfs://","https://ipfs.io/ipfs/")}catch(e){}let n="";e.name&&(n=s(e.name));let i=a(e.address),o="";e.desc&&(o=q(e.desc,null,null));let l,r="";if(e.location&&(r=s(e.location)),e.website)try{l=new URL(e.website)}catch(e){}let d="";e.twitter&&(d=s(e.twitter));let c='<div class="p-3 mb-4"><article class="media" style="display: flex; height: 100%;"><figure class="media-left"><p class="image is-128x128"><img class="is-rounded" style="height:100%;" src="'+t+'"/></p></figure><div class="media-content" style="overflow: hidden;"><div class="content mb-0 is-size-4"><b>'+(n?n+"&nbsp;":"")+"</b>@"+e.username+'</div><div class="content is-small"><span id="txtUserAddress" class="user-address">'+i+'&nbsp;<span class="icon is-small"><i class="fa-regular fa-clone"></i></span></span></div><div class="content">'+z(o)+'</div><div class="content">'+(r?'<span class="mr-5"><i class="fas fa-location-dot  pr-1"></i>'+r+"</span>":"")+(l?'<span class="mr-5"><i class="fas fa-globe pr-1"></i><a href="'+l.href+'" target="_blank">'+l.host+"</a></span>":"")+(d?'<span class="mr-5"><i class="fa-brands fa-twitter pr-1"></i><a href="https://twitter.com/'+d+'" target="_blank">'+d+"</a></span>":"")+'</div><div class="content"><small><i class="fa-regular fa-calendar pr-2"></i>'+new Date(Date.parse(e.reg_date)).toDateString().slice(4)+'</small></div><div class="content"><div class="tags"><span class="tag is-info is-normal"><i class="fa-regular fa-message"></i>&nbsp;Tweets&nbsp;:&nbsp;<b id="nposts">0</b></span><span class="tag is-danger is-normal"><i class="fa-solid fa-heart"></i>&nbsp;Likes&nbsp;:&nbsp;<b id="nlikes">0</b></span><span class="tag is-primary is-normal"><i class="fas fa-users"></i>&nbsp;Followers&nbsp;:&nbsp;<b id="nfollowers">0</b></span></div></div></div></article>';if(O()&&T!==e.address){c+='<div class="buttons is-justify-content-flex-end mt-3">';let t=await H(T);if(t){let n=t.has(e.username);c+='<button id="btnFollow" class="button is-primary is-rounded"'+(n||e.pol_follow!==E?"":' disabled=""')+">"+(n?"Unfollow":"Follow")+"</button>"}c+='<button id="btnDonate" class="button is-info is-rounded">Donate</button></div>'}return c+="</div>",c}function J(e,t,n){let a="";if(e.img)try{new URL(e.img),a=e.img.replace("ipfs://","https://ipfs.io/ipfs/")}catch(e){}return'<article class="media px-3 pt-0 tweet" data-address="'+e.address+'" data-username="'+e.username+'" data-mid="'+t.i+'" onclick="event.stopPropagation();window.location.search=\'u='+e.username+"&m="+t.i+'\';"><figure class="media-left pt-3"><p class="image is-32x32"><img class="is-rounded" style="height:100%;" src="'+a+'"></p></figure><div class="media-content pt-3"><div class="content">'+(n?'<span class="pl-1 pr-2"><span class="icon is-small"><i class="fas fa-retweet"></i></span></span>':"")+'<span class="tweet-name" onclick="event.stopPropagation();window.location.search=\'u='+e.username+"';\"><b>"+(e.name?s(e.name)+"&nbsp;":"")+"</b>@"+e.username+'</span><small class="has-text-grey"> &middot; '+new Date(Date.parse(t.t)).toLocaleString()+"</small>"+(T===t.a&&Date.parse(t.t)+h.get(v)>Date.now()?'<button class="button is-ghost is-rounded is-shadowless tweet-btn-edit is-pulled-right" tabindex="-1" style="position:relative;top:-8px;"><span class="icon is-small has-text-black"><i class="fa-regular fa-pen-to-square"></i></span></button>':"")+'</div><div id="msg_'+e.address+"_"+t.i+'" class="content">'+z(t.m)+'</div><nav class="level mb-1 is-mobile" style="overflow:hidden;"><div class="level-left"><div class="level-item mr-5"><button class="button is-ghost is-rounded is-shadowless tweet-btn-reply" tabindex="0"><span class="icon is-small has-text-info"><i class="fa-regular fa-comment"></i></span></button><span id="replyVal_'+e.address+"_"+t.i+'" class="ml-1 is-size-7">'+(t.r>0?t.r:"&nbsp;")+'</span></div><div class="level-item mr-5 px-0"><button class="button is-ghost is-rounded is-shadowless tweet-btn-retweet" tabindex="0"><span class="icon is-small"><i class="fas fa-retweet"></i></span></button><span id="retweetVal_'+e.address+"_"+t.i+'" class="is-size-7">'+(t.c>0?t.c:"&nbsp;")+'</span></div><div class="level-item mr-5 px-0"><button class="button is-ghost is-rounded is-shadowless tweet-btn-like" tabindex="0"><span class="icon is-small has-text-danger"><i id="likeImg_'+e.address+"_"+t.i+'" class="fa-regular fa-heart"></i></span></button><span id="likeVal_'+e.address+"_"+t.i+'" class="is-size-7">'+(t.l>0?t.l:"&nbsp;")+'</span></div><div class="level-item"><button class="button is-ghost is-rounded is-shadowless tweet-btn-link" tabindex="0"><span class="icon is-small has-text-info-dark"><i class="fas fa-link"></i></span></button></div></div></nav></div></article>'}function D(e,t,n){let a="";if(e.img)try{new URL(e.img),a=e.img.replace("ipfs://","https://ipfs.io/ipfs/")}catch(e){}let i=e.name?s(e.name)+"&nbsp;":"",o=new Date(Date.parse(t.t)).toLocaleString(),l=z(t.m);const r=document.getElementById("t-reply").content.cloneNode(!0);if(r.querySelector(".js-img").setAttribute("src",a),r.querySelector(".tweet-name").setAttribute("onclick","event.stopPropagation();window.location.search='u="+e.username+"'"),r.querySelector(".js-name").innerHTML=i,r.querySelector(".js-username").innerText=e.username,r.querySelector(".js-date").innerText=o,r.querySelector(".js-msg").innerHTML=l,n){let e=r.querySelector("article");e&&e.setAttribute("data-mid",n.i);let s=r.querySelector(".tweet-btn-edit");s&&(T===t.a&&Date.parse(t.t)+h.get(v)>Date.now()?(e.setAttribute("data-address",t.a),e.setAttribute("data-pa",n.ta),e.setAttribute("data-pid",n.ti),s.classList.remove("is-hidden")):s.classList.add("is-hidden"))}return r}function z(e){let t=j(e),n="";if(t.hasOwnProperty("t")&&t.t&&t.t.length>0){const e=new URL(document.location.href);n=s(t.t),n=n.replaceAll(/(^|\s)@(\w{3,15})\b/gm,((t,n,s)=>n+"<a href='"+e.origin+e.pathname+"?u="+s.toLowerCase()+"'>@"+s+"</a>")),n=n.replaceAll(/(^|\s)(((http|ftp|ftps|https):\/\/)([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:\/~+#-_]*[\w@?^=%&\/~+#-_]))/gm,((e,t,n)=>t+"<a href='"+n+"' target='_blank' onclick='event.stopPropagation();'>"+n+"</a>")),n=n.replaceAll("\n","<br/>")}if(t.hasOwnProperty("i")&&t.i)try{n+="<figure class='image mx-0 mt-5'><img src='"+new URL(t.i).toString().replace("ipfs://","https://ipfs.io/ipfs/")+"'></figure>"}catch(e){}else if(t.hasOwnProperty("y")&&t.y)try{new URL(t.y),n+=t.y.replace(/^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube(-nocookie)?\.com|youtu.be))(\/(?:[\w\-]+\?v=|embed\/|v\/)?)([\w\-]+)(\S+)?$/gm,(e=>{let t=e.match("^(?:https?:)?//[^/]*(?:youtube(?:-nocookie)?.com|youtu.be).*[=/]([-\\w]{11})(?:\\?|=|&|$)");return t&&(e="<figure class='image mx-0 mt-5 is-16by9'><iframe class='has-ratio' width='640' height='360' src='https://www.youtube.com/embed/"+t[1]+"' frameborder='0' allowfullscreen></iframe>"+e+"</figure>"),e}))}catch(e){}return n}function q(e,n,s){let a={t:void 0,i:void 0,y:void 0,a:void 0,v:void 0};if(e&&e.length>0&&(a.t=e),n&&s)switch(s){case"i":a.i=n;break;case"y":a.y=n;break;case"a":a.a=n;break;case"v":a.v=n}console.log("INFO codeMsgData(): msg="+JSON.stringify(a));let i=t(JSON.stringify(a));return console.log("INFO codeMsgData(): r="+i),i}function j(e){let t={};try{t=JSON.parse(n(e))}catch(s){t.t=n(e)}return t}const V={message:"Connect your wallet",type:"is-danger"},$={message:"That TwiTez user doesn't exist",type:"is-danger"},G={message:"Tweet doesn't exist",type:"is-danger"},W={message:"Copied to clipboard",type:"is-info"};function Y(e){let t="";e&&e.length>0&&(t=" with ID <a href='https://"+r+".tzkt.io/"+e+"' target='_blank'>"+a(e)+"</a>"),bulmaToast.toast({message:"Your request is processing"+t,duration:5e3,type:"is-info"})}function K(e){if(navigator.clipboard)return navigator.clipboard.writeText(e).then((function(){}),(function(e){console.log("ERROR copyToClipboard(): "+e)})),void bulmaToast.toast(W);let t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),bulmaToast.toast(W)}catch(e){}document.body.removeChild(t)}async function X(){let e=document.getElementById("iSearch").value;e=e.trim(),e&&(e=e.toLowerCase(),window.location.search="u="+e)}function Q(e){document.getElementById("tUsername").innerHTML=e,document.getElementById("dLogin").classList.add("is-hidden"),document.getElementById("dUser").classList.remove("is-hidden")}async function Z(){let e=document.getElementById("iUsername").value,t="";if(e&&e.length>=h.get(g)&&e.length<=h.get(u)){e=e.toLowerCase();for(let n=0;n<e.length;n++)if(-1==="abcdefghijklmnopqrstuvwxyz0123456789_".indexOf(e.charAt(n))){t='Invalid character "<b>'+e[n]+'</b>" at position '+(n+1);break}}else t="Username length has to be in ["+h.get(g)+".."+h.get(u)+"]";if(t&&t.length>0)bulmaToast.toast({message:t,type:"is-danger"});else{e=e.toLowerCase();let t=await async function(e){if(await A(),await S(),!N())return console.log("ERROR register(): "+R),null;e=e.toLowerCase();try{const t=await m.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:d,parameters:{entrypoint:"register_user",value:JSON.parse('{"string":'+JSON.stringify(e)+"}")}}]});if(t.transactionHash)return b.set(e,T),t.transactionHash}catch(e){console.log("ERROR register(): "+JSON.stringify(e))}return null}(e);t&&ee(t,e),te()}}async function ee(e,t,n){document.getElementById("mStatus").classList.add("is-active"),n||(n=Date.now());let s=await async function(e){console.log("INFO getTxStatus(): getting status for "+e);try{let t=await fetch("https://api."+r+".tzkt.io/v1/operations/transactions/"+e+"/status");if(t.ok){const e=await t.text();if(console.log("INFO getTxStatus(): status="+e),e)return JSON.parse(e)}else console.log("ERROR getTxStatus(): can't get status for "+e)}catch(e){console.log("ERRROR getTxStatus(): "+e+" "+JSON.stringify(e))}return null}(e);s?(await _(!0),O()?(Q((await U(T)).username),bulmaToast.toast({message:"Sign Up process has been completed successfully",duration:5e3,type:"is-success"})):(ne(),bulmaToast.toast({message:"User data can not be loaded",duration:6e3,type:"is-danger"})),document.getElementById("mStatus").classList.remove("is-active")):!1===s?(document.getElementById("mStatus").classList.remove("is-active"),bulmaToast.toast({message:"Sign Up process has not been completed",duration:6e3,type:"is-danger"})):Date.now()-n<3e4?setTimeout(ee,3e3,e,t,n):(document.getElementById("mStatus").classList.remove("is-active"),bulmaToast.toast({message:"Sign Up process takes much time...",duration:6e3,type:"is-warning"}))}function te(){document.getElementById("mSignUp").classList.remove("is-active")}function ne(){document.getElementById("dUserMenu").classList.remove("is-active"),document.getElementById("tUsername").innerHTML="",document.getElementById("dUser").classList.add("is-hidden"),document.getElementById("dLogin").classList.remove("is-hidden")}function se(){document.getElementById("mFollowing").classList.remove("is-active")}function ae(){document.getElementById("bProfileEdit").classList.add("is-hidden"),document.getElementById("bProfilePreview").classList.remove("is-hidden"),document.getElementById("dProfilePreview").classList.add("is-hidden"),document.getElementById("dProfileEdit").classList.remove("is-hidden")}function ie(){document.getElementById("mProfile").classList.remove("is-active")}function oe(){document.getElementById("mSettings").classList.remove("is-active")}function le(){let e=event.target;document.querySelectorAll(".js-donate-btn").forEach((function(e){e.classList.remove("is-active"),e.classList.remove("is-info")})),e.classList.add("is-active"),e.classList.add("is-info"),document.getElementById("mmDonationAmount").value=e.getAttribute("data-amount")}async function re(e,t,n){if(O()){if(t&&n?(document.getElementById("mNewTweet").setAttribute("data-pa",t),document.getElementById("mNewTweet").setAttribute("data-pid",n),document.getElementById("mntTitleTweet").classList.add("is-hidden"),document.getElementById("mntTitleReply").classList.remove("is-hidden")):(document.getElementById("mNewTweet").removeAttribute("data-pa"),document.getElementById("mNewTweet").removeAttribute("data-pid"),document.getElementById("mntTitleTweet").classList.remove("is-hidden"),document.getElementById("mntTitleReply").classList.add("is-hidden")),e){let s=t&&n?await async function(e){console.log("INFO getReply(): getting reply for id="+e);try{let t=await fetch(c+"/bigmaps/replies/keys/?key.i="+e+"&active=true&select=value");if(t.ok){let e=await t.json();if(console.log("INFO getReply(): tweet="+JSON.stringify(e)),e&&e.length>0)return e[0]}else console.log("ERROR getReply(): can't get reply for id="+e)}catch(e){console.log("ERRROR getReply(): "+JSON.stringify(e))}return null}(e):await P(T,e);if(!s)return void bulmaToast.toast(G);{document.getElementById("mNewTweet").setAttribute("data-mid",e);let t=j(s.m);t.hasOwnProperty("t")&&t.t&&t.t.length>0&&(document.getElementById("tNewTweet").value=t.t);const n=document.getElementById("selMediaType"),a=document.getElementById("iMediaLink");t.hasOwnProperty("i")&&t.i?(n.value="i",n.dispatchEvent(new Event("change")),a.value=t.i):t.hasOwnProperty("y")&&t.y&&t.y.length>0&&(n.value="y",n.dispatchEvent(new Event("change")),a.value=t.y)}document.getElementById("mntTitleNew").classList.add("is-hidden"),document.getElementById("mntTitleEdit").classList.remove("is-hidden")}else document.getElementById("mntTitleNew").classList.remove("is-hidden"),document.getElementById("mntTitleEdit").classList.add("is-hidden"),document.getElementById("tNewTweet").value="",document.getElementById("selMediaType").value="",document.getElementById("selMediaType").dispatchEvent(new Event("change")),document.getElementById("mNewTweet").removeAttribute("data-mid");document.getElementById("mNewTweet").classList.add("is-active"),de()}else bulmaToast.toast(V)}function de(){document.getElementById("dNewTweetPreview").innerHTML="",document.getElementById("bNewTweetEdit").classList.add("is-hidden"),document.getElementById("bNewTweetPreview").classList.remove("is-hidden"),document.getElementById("dNewTweetPreview").classList.add("is-hidden"),document.getElementById("dNewTweetEdit").classList.remove("is-hidden"),document.getElementById("tNewTweet").focus()}function ce(){document.getElementById("mNewTweet").classList.remove("is-active")}async function me(){if(event.stopPropagation(),!O())return void bulmaToast.toast(V);let e=event.target.closest("article");if(e){let t=e.getAttribute("data-address"),n=e.getAttribute("data-mid"),s=e.getAttribute("data-pa"),a=e.getAttribute("data-pid");t===T&&re(n,s,a)}}async function ge(){event.stopPropagation();let e=event.target.closest("article");e||(e=event.target.closest("nav")),e&&re(null,e.getAttribute("data-address"),e.getAttribute("data-mid"))}async function ue(){if(event.stopPropagation(),!O())return void bulmaToast.toast(V);let e=event.target.closest("article");e||(e=event.target.closest("nav"));let t=e.getAttribute("data-address"),n=e.getAttribute("data-mid"),s=await U(t);console.log("author="+JSON.stringify(s));let a=await async function(e,t){try{const n=await m.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:d,parameters:{entrypoint:"retweet",value:JSON.parse('{ "prim": "Pair", "args": [ { "string": "'+e+'" }, { "int": "'+t+'" } ] }')}}]});if(n.transactionHash)return n.transactionHash}catch(e){console.log("ERROR retweet(): "+JSON.stringify(e))}return!1}(t,n);if(a){Y();let e=document.getElementById("retweetVal_"+t+"_"+n);if(e){let t=parseInt(e.innerHTML);t=isNaN(t)?1:t+1,e.innerHTML=t>0?t:"&nbsp;"}}}async function ye(){if(event.stopPropagation(),!O())return void bulmaToast.toast(V);let e=event.target.closest("article");if(e){let t=e.getAttribute("data-address"),n=e.getAttribute("data-username"),s=e.getAttribute("data-mid");if(isNaN(s)||parseInt(s)<0)return;if(await F(n,s)){Y();let e=document.getElementById("likeImg_"+t+"_"+s),n=document.getElementById("likeVal_"+t+"_"+s),a=document.getElementById("nlikes"),i=parseInt(n.innerHTML),o=a?parseInt(a.innerHTML):0;e.classList.contains("fa-regular")?(i=isNaN(i)?1:i+1,o=isNaN(o)?1:o+1):(i=isNaN(i)?0:i-1,o=isNaN(o)?0:o-1),e&&(e.classList.toggle("fa-regular"),e.classList.toggle("fa-solid")),n&&(n.innerHTML=i>0?i:"&nbsp;"),a&&(a.innerHTML=o)}}}async function pe(){event.stopPropagation();let e=event.target.closest("article");if(e||(e=event.target.closest("nav")),e){let t=new URL(window.location);t.search="u="+e.getAttribute("data-username")+"&m="+e.getAttribute("data-mid"),K(t.toString())}}async function fe(e){e.querySelectorAll(".tweet-btn-reply").forEach((function(e){e.onclick=ge})),e.querySelectorAll(".tweet-btn-retweet").forEach((function(e){e.onclick=ue})),e.querySelectorAll(".tweet-btn-like").forEach((function(e){e.onclick=ye})),e.querySelectorAll(".tweet-btn-link").forEach((function(e){e.onclick=pe})),e.querySelectorAll(".tweet-btn-edit").forEach((function(e){e.onclick=me}))}async function we(e){if(O()&&e.size>0)for(let t of e){let e=await C(t);if(e)for(let n of e){let e=document.getElementById("likeImg_"+t+"_"+n);e&&(e.classList.toggle("fa-regular"),e.classList.toggle("fa-solid"))}}}function ve(){document.getElementById("dMainPage").classList.add("is-hidden"),document.getElementById("dMainNewTweets").innerHTML="",document.getElementById("dContent").classList.add("is-hidden"),document.getElementById("dUserContent").innerHTML="",document.getElementById("dMessages").innerHTML="",document.getElementById("dTweetContent").classList.add("is-hidden"),document.getElementById("dTweet").innerHTML="",document.getElementById("dReplies").innerHTML=""}bulmaToast.setDefaults({duration:6e3,position:"bottom-left",dismissible:!0,animate:{in:"zoomIn",out:"zoomOut"}}),document.getElementById("btnSearch").addEventListener("click",(()=>X())),document.getElementById("iSearch").addEventListener("keyup",(function(e){e.preventDefault(),13===e.keyCode&&X()})),document.addEventListener("DOMContentLoaded",(async function(){await _(!0),O()?Q((await U(T)).username):ne();let e=new URL(document.location.href);if(e){let t=e.searchParams.get("u");if(t&&t.length>0){"@"===t[0]&&(t=t.substring(1)),t=decodeURIComponent(t);let n=await M(t);console.log("INFO onLoad(): username="+t+" address="+n);let a=e.searchParams.get("m");return void(a?(a=decodeURIComponent(a),console.log("INFO onLoad(): msgId="+a),await async function(e,t){let n,a;if(console.log("INFO showReplies(): show replies for address="+e+" id="+t),ve(),document.getElementById("dTweetNavPanel").classList.add("is-hidden"),document.getElementById("dTweetContentError").classList.add("is-hidden"),document.getElementById("dTweetContentLoading").classList.remove("is-hidden"),document.getElementById("dTweetContent").classList.remove("is-hidden"),e&&t&&(n=await U(e),a=await P(e,t)),n&&a){let i=function(e,t){let n="";if(e.img)try{new URL(e.img),n=e.img.replace("ipfs://","https://ipfs.io/ipfs/")}catch(e){}return'<article class="media px-3 pt-3"><figure class="media-left"><p class="image is-32x32"><img class="is-rounded" style="height:100%;" src="'+n+'"></p></figure><div class="media-content"><div class="content"><span class="tweet-name" onclick="event.stopPropagation();window.location.search=\'u='+e.username+"';\"><b>"+(e.name?s(e.name)+"&nbsp;":"")+"</b>@"+e.username+'</span><small class="has-text-grey"> &middot; '+new Date(Date.parse(t.t)).toLocaleString()+'</small></div><div class="content">'+z(t.m)+'</div><nav class="level pt-5 pb-3 is-mobile" style="overflow: hidden;" data-address="'+e.address+'" data-username="'+e.username+'" data-mid="'+t.i+'"><div class="level-left"><div class="level-item mr-6"><hr class="p-0 m-0"/><span id="replyVal_'+e.address+"_"+t.i+'" class="has-text-weight-bold">'+t.r+'</span><span class="has-text-grey">&nbsp;replies</span></div><div class="level-item mr-6"><hr class="p-0 m-0"/><span id="retweetVal_'+e.address+"_"+t.i+'" class="has-text-weight-bold">'+t.c+'</span><span class="has-text-grey">&nbsp;retweets</span></div><div class="level-item"><span id="likeVal_'+e.address+"_"+t.i+'" class="has-text-weight-bold">'+t.l+'</span><span class="has-text-grey">&nbsp;likes</span></div></div></nav></div></article>'}(n,a);document.getElementById("dTweet").innerHTML=i,document.getElementById("dTweetNavPanel").classList.remove("is-hidden");let o=document.getElementById("dTweetNav");o.setAttribute("data-username",n.username),o.setAttribute("data-address",n.address),o.setAttribute("data-mid",t);let l=await async function(e,t){console.log("INFO getReplies(): getting replies for address="+e+" id="+t);try{let n=await fetch(c+"/bigmaps/replies/keys/?key.ta="+e+"&key.ti="+t+"&active=true&select=key,value");if(n.ok){let e=await n.json();if(console.log("INFO getReplies(): replies="+JSON.stringify(e)),e&&e.length>0)return e}else console.log("ERROR getReplies(): can't get replies for address="+e+" id="+t)}catch(e){console.log("ERRROR getReplies(): "+JSON.stringify(e))}return null}(e,t);if(l){let e=document.getElementById("dReplies");for(let t of l)n=await U(t.value.a),e.append(D(n,t.value,t.key));e.querySelectorAll(".tweet-btn-edit").forEach((function(e){e.onclick=me}))}if(O()){let n=await C(e);if(n)for(let e of n)if(e===t){let e=document.getElementById("btnTweetLikeImg");e&&(e.classList.toggle("fa-regular"),e.classList.toggle("fa-solid"));break}}}else document.getElementById("dTweetContentError").classList.remove("is-hidden");document.getElementById("dTweetContentLoading").classList.add("is-hidden")}(n,a)):await async function(e){let t;if(console.log("INFO showUserTweets(): show content for address="+e),ve(),document.getElementById("dContentError").classList.add("is-hidden"),document.getElementById("dContentLoading").classList.remove("is-hidden"),document.getElementById("dContent").classList.remove("is-hidden"),e&&(t=await U(e)),t){let n=await x(t)+"<hr class='p-0 m-0'/>";document.getElementById("dUserContent").innerHTML=n;let s=document.getElementById("txtUserAddress");s&&s.addEventListener("click",(()=>K(t.address)));let a=document.getElementById("btnDonate");a&&a.addEventListener("click",(()=>function(e){e&&(document.getElementById("dUserMenu").classList.remove("is-active"),document.getElementById("mmDonationAddress").value=e,document.getElementById("mDonate").classList.add("is-active"))}(t.address)));let i=document.getElementById("btnFollow");i&&i.addEventListener("click",(()=>async function(e){if(!O())return void bulmaToast.toast(V);if(!e)return;e=e.toLowerCase();let t=await async function(e){e=e.toLowerCase();try{const t=await m.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:d,parameters:{entrypoint:"follow",value:JSON.parse('{"string":'+JSON.stringify(e)+"}")}}]});if(t.transactionHash)return t.transactionHash}catch(e){console.log("ERROR follow(): "+JSON.stringify(e))}return!1}(e);if(t){Y();let t=parseInt(document.getElementById("nfollowers").innerHTML),n=document.getElementById("btnFollow"),s=await H(T);if(s){if(s.has(e)){s.delete(e),t=isNaN(t)?0:t-1,n.innerHTML="Follow";let a=await U(await M(e));a&&a.pol_follow===E&&n.setAttribute("disabled","")}else s.add(e),t=isNaN(t)?1:t+1,n.innerHTML="Unfollow";I.set(T,s)}document.getElementById("nfollowers").innerHTML=t}}(t.username)));let o=await async function(e){console.log("INFO getUserTotal(): getting total info for address="+e);try{let t=await fetch(c+"/bigmaps/users_total/keys/?key="+e+"&active=true&select=value");if(t.ok){let e=await t.json();if(e)return console.log("INFO getUserTotal(): total="+JSON.stringify(e[0])),e[0]}else console.log("ERROR getUserTotal(): can't get total info for address="+e)}catch(e){console.log("ERRROR getUserTotal(): "+e)}return null}(t.address);o&&(document.getElementById("nposts").innerHTML=o.tweets,document.getElementById("nlikes").innerHTML=o.likes,document.getElementById("nfollowers").innerHTML=o.followers),n="";let l=await async function(e){console.log("INFO getTweets(): getting tweets for address="+e);try{let t=await fetch(c+"/bigmaps/tweets/keys/?key.a="+e+"&active=true&select=value");if(t.ok){let e=await t.json();if(console.log("INFO getTweets(): tweets="+JSON.stringify(e)),e&&e.length>0)return e}else console.log("ERROR getTweets(): can't get tweets for address="+e)}catch(e){console.log("ERRROR getTweets(): "+JSON.stringify(e))}return null}(e);if(l){let e=new Set;for(let s of l)e.add(s.a),n=""===s.m?J(await U(s.a),await P(s.a,s.i),!0)+"<hr class='p-0 m-0'/>"+n:J(t,s)+"<hr class='p-0 m-0'/>"+n;let s=document.getElementById("dMessages");s.innerHTML=n,fe(s),await we(e)}}else document.getElementById("dContentError").classList.remove("is-hidden");document.getElementById("dContentLoading").classList.add("is-hidden")}(n))}}console.log("INFO onLoad(): show last tweets"),await async function(){console.log("INFO showLastTweets(): show last tweets"),ve(),document.getElementById("tabNewTweets").classList.add("is-active"),document.getElementById("dMainPage").classList.remove("is-hidden");let e="",t=await async function(e){console.log("INFO getLastTweets(): getting last tweets");try{let e=await fetch(c+'/bigmaps/tweets/keys/?sort.desc=id&value.m.ne=""&select=key,value&limit=25');if(e.ok){let t=await e.json();if(console.log("INFO getLastTweets(): last tweets="+JSON.stringify(t)),t&&t.length>0)return t}else console.log("ERROR getLastTweets(): can't get last tweets")}catch(e){console.log("ERRROR getLastTweets(): "+JSON.stringify(e))}return null}();if(t){let n=new Set;for(let s of t)n.add(s.key.a),e+=J(await U(s.key.a),s.value)+"<hr class='p-0 m-0'/>";let s=document.getElementById("dMainNewTweets");s.innerHTML=e,fe(s),await we(n)}}()})),document.getElementById("btnLogIn").addEventListener("click",(()=>async function(){await _(!1),N()?O()?window.location.reload():(bulmaToast.toast($),ne()):(bulmaToast.toast(V),ne())}())),document.getElementById("iUsername").addEventListener("keyup",(function(e){e.preventDefault(),13===e.keyCode?Z():27===e.keyCode&&te()})),document.getElementById("bSignUpSignup").addEventListener("click",(()=>Z())),document.getElementById("btnSignUp").addEventListener("click",(()=>(document.getElementById("mSignUp").classList.add("is-active"),document.getElementById("iUsername").value="",void document.getElementById("iUsername").focus()))),document.getElementById("bSignUpClose").addEventListener("click",(()=>te())),document.getElementById("bSignUpCancel").addEventListener("click",(()=>te())),document.getElementById("btnLogout").addEventListener("click",(()=>async function(){await A(),ne(),window.location.reload()}())),document.getElementById("btnMyTweets").addEventListener("click",(()=>async function(){if(O()){document.getElementById("dUserMenu").classList.remove("is-active"),document.getElementById("iSearch").value="";let e=await U(T);window.location.search="u="+e.username}}())),document.getElementById("btnFollowing").addEventListener("click",(()=>async function(){document.getElementById("dUserMenu").classList.remove("is-active"),document.getElementById("mFollowingContent").innerHTML="",document.getElementById("mFollowingLoading").classList.remove("is-hidden");let e="";document.getElementById("mFollowing").classList.add("is-active");let t=await H(T);if(t&&t.size>0){let n=0;for(let s of t)n++,n>1&&(e+=", "),e+=n%2==1?"<i class='fa-regular fa-user'></i>":"<i class='fa-solid fa-user'></i>",e+=" <a href='./index.html?u="+s+"'>"+s+"</a>"}document.getElementById("mFollowingLoading").classList.add("is-hidden"),document.getElementById("mFollowingContent").innerHTML=e}())),document.getElementById("bFollowingClose").addEventListener("click",(()=>se())),document.getElementById("bFollowingCancel").addEventListener("click",(()=>se())),document.getElementById("btnProfile").addEventListener("click",(()=>(document.getElementById("dUserMenu").classList.remove("is-active"),void async function(){if(!O())return void bulmaToast.toast(V);let e=await U(T);document.getElementById("prUsername").value=e.username,document.getElementById("prName").value=e.name,document.getElementById("prImg").value=e.img,document.getElementById("prDesc").value=e.desc,document.getElementById("prLocation").value=e.location,document.getElementById("prWebsite").value=e.website,document.getElementById("prTwitter").value=e.twitter,document.getElementById("mProfile").classList.add("is-active"),ae()}()))),document.getElementById("bProfileEdit").addEventListener("click",(()=>ae())),document.getElementById("bProfilePreview").addEventListener("click",(()=>async function(){if(!O())return void bulmaToast.toast(V);let e=await U(T);var t={address:e.address,username:e.username,reg_date:e.reg_date,name:document.getElementById("prName").value.trim(),img:document.getElementById("prImg").value.trim(),desc:document.getElementById("prDesc").value.trim(),location:document.getElementById("prLocation").value.trim(),twitter:document.getElementById("prTwitter").value.trim(),website:document.getElementById("prWebsite").value.trim()};if(t.img)try{new URL(t.img)}catch(e){return void bulmaToast.toast({type:"is-danger",message:"Invalid image URL"})}if(t.website)try{t.website=new URL(t.website).toString()}catch(e){return void bulmaToast.toast({type:"is-danger",message:"Invalid website URL"})}let n=await x(t);document.getElementById("dProfilePreview").innerHTML=n,document.getElementById("bProfilePreview").classList.add("is-hidden"),document.getElementById("bProfileEdit").classList.remove("is-hidden"),document.getElementById("dProfileEdit").classList.add("is-hidden"),document.getElementById("dProfilePreview").classList.remove("is-hidden")}())),document.getElementById("bProfileSave").addEventListener("click",(()=>async function(){if(!O())return void bulmaToast.toast(V);let e=document.getElementById("prName").value.trim(),n=document.getElementById("prImg").value.trim(),s=document.getElementById("prDesc").value.trim(),a=document.getElementById("prLocation").value.trim(),i=document.getElementById("prWebsite").value.trim(),o=document.getElementById("prTwitter").value.trim();if(e&&(e.length<h.get(y)||e.length>h.get(p)))bulmaToast.toast({type:"is-danger",message:"Name length has to be in ["+h.get(y)+".."+h.get(p)+"]"});else{if(n)try{new URL(n)}catch(e){return void bulmaToast.toast({type:"is-danger",message:"Invalid image URL"})}if(i)try{i=new URL(i).toString()}catch(e){return void bulmaToast.toast({type:"is-danger",message:"Invalid website URL"})}o.length>0&&!/^@?(\w){4,15}$/.test(o)?bulmaToast.toast({type:"is-danger",message:"Invalid twitter username"}):await async function(e,n,s,a,i,o){if(!N())return console.log("ERROR profile(): "+R),!1;let l=L.get(T);if(!l)return console.log("ERROR profile(): "+B),!1;let r="";if(l.desc!==s&&(r.length>0&&(r+=","),r+='{"prim":"Elt","args":[{"string":"desc" },{"bytes":"'+t(s)+'"}]}'),l.img!==n&&(r.length>0&&(r+=","),r+='{"prim":"Elt","args":[{"string":"img" },{"bytes":"'+t(n)+'"}]}'),l.location!==a&&(r.length>0&&(r+=","),r+='{"prim":"Elt","args":[{"string":"loc" },{"bytes":"'+t(a)+'"}]}'),l.name!==e&&(r.length>0&&(r+=","),r+='{"prim":"Elt","args":[{"string":"name" },{"bytes":"'+t(e)+'"}]}'),l.twitter!==o&&(r.length>0&&(r+=","),r+='{"prim":"Elt","args":[{"string":"twitter" },{"bytes":"'+t(o)+'"}]}'),l.website!==i&&(r.length>0&&(r+=","),r+='{"prim":"Elt","args":[{"string":"web" },{"bytes":"'+t(i)+'"}]}'),r.length>0)try{if((await m.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:d,parameters:{entrypoint:"set_props",value:JSON.parse("["+r+"]")}}]})).transactionHash)return l.name=e,l.img=n,l.desc=s,l.location=a,l.twitter=o,l.website=i,L.set(T,l),!0}catch(e){console.log("ERROR profile(): "+e+" "+JSON.stringify(e))}else console.log("WARNING profile(): no new data");return!1}(e,n,s,a,i,o)&&(ie(),Y())}}())),document.getElementById("bProfileClose").addEventListener("click",(()=>ie())),document.getElementById("bProfileCancel").addEventListener("click",(()=>ie())),document.getElementById("btnSettings").addEventListener("click",(()=>(document.getElementById("dUserMenu").classList.remove("is-active"),void async function(){if(!O())return void bulmaToast.toast(V);let e=await U(T);document.getElementById("selFollow").value=e.pol_follow>0?1:e.pol_follow,document.getElementById("mSettings").classList.add("is-active")}()))),document.getElementById("bSettingsSave").addEventListener("click",(()=>async function(){let e=document.getElementById("selFollow").value,t=await async function(e){if(!N())return console.log("ERROR policies(): "+R),!1;let t=L.get(T);if(!t)return console.log("ERROR policies(): "+B),!1;if(e=String(e),t.pol_follow!==e)try{if((await m.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:d,parameters:{entrypoint:"set_policies",value:JSON.parse('{"int":"'+e+'"}')}}]})).transactionHash)return t.pol_follow=e,L.set(T,t),!0}catch(e){console.log("ERROR policies(): "+e+" "+JSON.stringify(e))}else console.log("WARNING policies(): no new data");return!1}(e);t&&Y(),oe()}())),document.getElementById("bSettingsClose").addEventListener("click",(()=>oe())),document.getElementById("bSettingsCancel").addEventListener("click",(()=>oe())),document.querySelectorAll(".js-donate-btn").forEach((function(e){e.onclick=le})),document.getElementById("bDonate").addEventListener("click",(()=>async function(){let e=document.getElementById("mmDonationAmount").value;if(e&&e>0){let t=await async function(e,t){t=function(e,t){let n=String(e),s=Number(6),a=n.indexOf(".");return a<0?n+"0".repeat(s):n.substring(0,a)+(n.length-a-1>=s?n.substring(a+1,a+1+s):n.substring(a+1)+"0".repeat(s-(n.length-a-1)))}(t);try{const n=await m.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:t,destination:e}]});if(n.transactionHash)return n.transactionHash}catch(e){console.log("ERROR send(): "+JSON.stringify(e))}return!1}(document.getElementById("mmDonationAddress").value,e);t&&Y(t),document.getElementById("mDonate").classList.remove("is-active")}else bulmaToast.toast({message:"Enter <b>amount</b> in (0, inf)",type:"is-danger"})}())),document.getElementById("btnNewTweet").addEventListener("click",(()=>(document.getElementById("dUserMenu").classList.remove("is-active"),void re()))),document.getElementById("selMediaType").addEventListener("change",(()=>function(){let e=document.getElementById("selMediaType").value;const t=document.getElementById("iMediaLink"),n=document.getElementById("sMediaIcon");switch(t.value="",e){case"":t.disabled=!0,t.placeholder="",n.innerHTML="";break;case"i":t.disabled=!1,t.placeholder="Image URL (http:// https:// ipfs://) ...",n.innerHTML='<i class="fa-regular fa-image"></i>';break;case"y":t.disabled=!1,t.placeholder="Youtube video URL ...",n.innerHTML='<i class="fa-brands fa-youtube"></i>'}}())),document.getElementById("bNewTweetEdit").addEventListener("click",(()=>de())),document.getElementById("bNewTweetPreview").addEventListener("click",(()=>async function(){if(!O())return void bulmaToast.toast(V);let e=document.getElementById("tNewTweet").value.trim(),t=document.getElementById("iMediaLink").value.trim(),n=document.getElementById("selMediaType").value;if(!e&&!t)return void bulmaToast.toast({type:"is-danger",message:"Tweet can not be empty"});if(t)try{new URL(t)}catch(e){return void bulmaToast.toast({type:"is-danger",message:"Invalid media URL"})}let s={t:new Date,m:q(e,t,n)};document.getElementById("dNewTweetPreview").innerHTML="",document.getElementById("dNewTweetPreview").append(D(await U(T),s)),document.getElementById("bNewTweetPreview").classList.add("is-hidden"),document.getElementById("bNewTweetEdit").classList.remove("is-hidden"),document.getElementById("dNewTweetEdit").classList.add("is-hidden"),document.getElementById("dNewTweetPreview").classList.remove("is-hidden")}())),document.getElementById("bNewTweetSend").addEventListener("click",(()=>async function(){let e=document.getElementById("tNewTweet").value.trim(),t=document.getElementById("iMediaLink").value.trim(),n=document.getElementById("selMediaType").value;if(!e&&!t)return void bulmaToast.toast({type:"is-danger",message:"Tweet can not be empty"});if(t)try{new URL(t)}catch(e){return void bulmaToast.toast({type:"is-danger",message:"Invalid media URL"})}let s=q(e,t,n);if(console.log("INFO sendNewTweet(): tweet="+s),s&&s.length>=h.get(f)&&s.length<=h.get(w)){let e,t=document.getElementById("mNewTweet").getAttribute("data-mid"),n=document.getElementById("mNewTweet").getAttribute("data-pa"),a=document.getElementById("mNewTweet").getAttribute("data-pid");if(e=n&&a?t?await async function(e,t,n,s){if(!N())return console.log("ERROR update_reply(): "+R),!1;if(!O())return console.log("ERROR update_reply(): "+B),!1;try{const a=await m.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:d,parameters:{entrypoint:"update_reply",value:JSON.parse('{"prim":"Pair","args":[{"prim":"Pair","args":[{"int":"'+s+'"},{"bytes":"'+n+'"}]},{"prim":"Pair","args":[{"string":"'+e+'"},{"int":"'+t+'"}]}]}')}}]});if(a.transactionHash)return a.transactionHash}catch(e){console.log("ERROR update_reply(): "+JSON.stringify(e))}return!1}(n,a,s,t):await async function(e,t,n){if(!N())return console.log("ERROR reply(): "+R),!1;if(!O())return console.log("ERROR reply(): "+B),!1;try{const s=await m.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:d,parameters:{entrypoint:"reply",value:JSON.parse('{"prim":"Pair","args":[{"bytes":"'+n+'"},{"prim":"Pair","args":[{"string":"'+e+'"},{"int":"'+t+'"}]}]}')}}]});if(s.transactionHash)return s.transactionHash}catch(e){console.log("ERROR reply(): "+JSON.stringify(e))}return!1}(n,a,s):t?await async function(e,t){if(!N())return console.log("ERROR update_msg(): "+R),!1;if(!O())return console.log("ERROR update_msg(): "+B),!1;try{if((await m.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:d,parameters:{entrypoint:"update_tweet",value:JSON.parse('{"prim":"Pair","args":[{"int":"'+t+'"},{"bytes":"'+e+'"}]}')}}]})).transactionHash)return!0}catch(e){console.log("ERROR update_msg(): "+JSON.stringify(e))}return!1}(s,t):await async function(e){if(!N())return console.log("ERROR msg(): "+R),!1;if(!O())return console.log("ERROR msg(): "+B),!1;try{if((await m.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:d,parameters:{entrypoint:"tweet",value:JSON.parse('{"prim":"Pair","args":[{"bytes":"'+e+'"},{"prim":"Pair","args":[{"int":"0"},{"int": "0"}]}]}')}}]})).transactionHash)return!0}catch(e){console.log("ERROR msg(): "+JSON.stringify(e))}return!1}(s),e){if(Y(),n&&a&&!t){let e=document.getElementById("replyVal_"+n+"_"+a);if(e){let t=parseInt(e.innerHTML);e.innerHTML=isNaN(t)?1:t+1}}ce()}}else bulmaToast.toast({type:"is-danger",message:"Message length has to be in ["+h.get(f)+".."+h.get(w)+"]"})}())),document.getElementById("bNewTweetClose").addEventListener("click",(()=>ce())),document.getElementById("bNewTweetCancel").addEventListener("click",(()=>ce())),document.getElementById("tNewTweet").addEventListener("keyup",(function(e){e.preventDefault(),27===e.keyCode&&ce()})),document.getElementById("btnTweetLike").addEventListener("click",(()=>async function(){if(event.stopPropagation(),!O())return void bulmaToast.toast(V);let e=event.target.closest("nav"),t=e.getAttribute("data-username"),n=e.getAttribute("data-address"),s=e.getAttribute("data-mid");if(console.log("INFO doTweetLike(): like/unlike for username="+t+" address="+n+" id="+s),await F(t,s)){Y();let e=document.getElementById("btnTweetLikeImg");if(e){let t=document.getElementById("likeVal_"+n+"_"+s);if(t){let n=parseInt(t.innerHTML);n=e.classList.contains("fa-regular")?isNaN(n)?1:n+1:isNaN(n)?0:n-1,t.innerHTML=n}e.classList.toggle("fa-regular"),e.classList.toggle("fa-solid")}}}())),document.getElementById("btnTweetReply").addEventListener("click",(()=>ge())),document.getElementById("btnTweetRetweet").addEventListener("click",(()=>ue())),document.getElementById("btnTweetLink").addEventListener("click",(()=>pe())),LT=e})();