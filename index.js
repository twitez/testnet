var LT;(()=>{"use strict";var e={};function t(e){return Array.from((new TextEncoder).encode(e),(e=>e.toString(16).padStart(2,"0"))).join("")}function n(e){const t=new Uint8Array(e.length/2);for(let n=0;n!==t.length;n++)t[n]=parseInt(e.substr(2*n,2),16);return(new TextDecoder).decode(t)}function s(e){return e&&e.length>14?e.substring(0,7)+"..."+e.substring(e.length-4):e}(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);const a="$u_",i="$f_",o="$a_",l="ghostnet",r="KT1GNCBXPwMwLsETn6AUdRzFz4Esx15yLaLY",d="https://api."+l+".tzkt.io/v1/contracts/"+r,c=new beacon.DAppClient({name:"TwiTez",matrixNodes:["https://rpc.mumbainet.teztnets.xyz","https://mumbainet.ecadinfra.com"]}),m="username_min_length",g="username_max_length",u="name_min_length",y="name_max_length",p="msg_min_length",f="msg_max_length",w="edit_tweet_time",v=new Map([[m,3],[g,15],[u,3],[y,50],[p,1],[f,250],[w,36e5]]),E="-1";var h=new class{constructor(e){this.storage=e?window.localStorage:window.sessionStorage}set(e,t){e&&t&&this.storage.setItem(o+e,t)}get(e){return this.storage.getItem(o+e)}has(e){return!!this.storage.getItem(o+e)}delete(e){this.storage.removeItem(o+e)}clear(){}size(){}},b=new class{constructor(e){this.storage=e?window.localStorage:window.sessionStorage}set(e,t){t&&this.storage.setItem(i+e,JSON.stringify(Array.from(t)))}get(e){try{return new Set(JSON.parse(this.storage.getItem(i+e)))}catch(t){console.log("*** CACHE_GET ERROR: key="+i+e+" error="+t)}return null}has(e){return!!this.storage.getItem(i+e)}delete(e){this.storage.removeItem(i+e)}clear(){}size(){}},I=new class{constructor(e){this.storage=e?window.localStorage:window.sessionStorage,this.size=0}set(e,t){this.storage.setItem(a+e,JSON.stringify(t)),this.size++}get(e){try{return JSON.parse(this.storage.getItem(a+e))}catch(t){console.log("*** CACHE_GET ERROR: key="+a+e+" error="+t)}return null}has(e){return!!this.storage.getItem(a+e)}delete(e){this.storage.removeItem(a+e),this.size--}clear(){this.storage.clear(),this.size=0}size(){return this.size}},T=null;const L="the wallet is not connected",R="the user is not logged in";function B(){return!!T}function N(){return T&&I.has(T)}async function O(){let e=await c.getActiveAccount();return!!e&&(T=e.address,console.log("INFO connectCached(): old userAddress="+T),!0)}async function k(){if(await O(),!B())try{const e=await c.requestPermissions({network:{type:l}});T=e.address,console.log("INFO connect(): new userAddress="+T)}catch(e){console.log("ERROR connect(): "+JSON.stringify(e))}}async function S(){await c.removeAllAccounts(),T=null,I.clear()}async function A(e){if(e?await O():(await S(),await k()),!B())return void console.log("ERROR login(): "+L);let t=await M(T);console.log("INFO login(): user="+JSON.stringify(t))}async function _(e){if(e=e.toLowerCase(),console.log("INFO getAddress(): getting address for username="+e),h.has(e))console.log("INFO getAddress(): cached for username="+e+" address="+h.get(e));else try{let t=await fetch(d+"/bigmaps/dns/keys/"+e);if(t.ok){let n=await t.json();h.set(e,n.value),console.log("INFO getAddress(): loaded for username="+e+" address="+h.get(e))}else console.log("ERROR getAddress(): can't getting address for username="+e)}catch(e){console.log("ERROR getAddress(): "+JSON.stringify(e))}return h.get(e)}async function M(e){console.log("INFO getUser(): getting user for address="+e);let t=I.get(e);if(t)return t;try{let s=await fetch(d+"/bigmaps/users/keys/?key="+e+"&active=true&select=value");if(s.ok){let a=await s.json();if(console.log("INFO getUser(): json="+JSON.stringify(a)),a&&a.length>0){t={},t.address=e,t.username=a[0].username,t.reg_date=a[0].reg_date,t.pol_follow=a[0].pol_follow;let s=a[0].props.name;t.name=s?n(s):"",s=a[0].props.img,t.img=s?n(s):"",s=a[0].props.desc,t.desc=s?n(s):"",s=a[0].props.loc,t.location=s?n(s):"",s=a[0].props.twitter,t.twitter=s?n(s):"",s=a[0].props.web,t.website=s?n(s):"",e===T&&await F(e),h.set(t.username,t.address),I.set(t.address,t),console.log("INFO getUser(): loaded for address="+e+" user="+JSON.stringify(t))}else console.log("ERROR getUser(): there is no user for address="+e)}else console.log("ERROR getUser(): can't get user for address="+e)}catch(e){console.log("ERROR getUser(): "+e)}return console.log("INFO getUser(): user="+JSON.stringify(t)),t}async function P(e,t){console.log("INFO getTweet(): getting tweet for address="+e+" id="+t);try{let n=await fetch(d+"/bigmaps/tweets/keys/?key.a="+e+"&key.i="+t+"&active=true&select=value");if(n.ok){let e=await n.json();if(console.log("INFO getTweet(): tweet="+JSON.stringify(e)),e&&e.length>0)return e[0]}else console.log("ERROR getTweet(): can't get tweet for address="+e+" id="+t)}catch(e){console.log("ERRROR getTweet(): "+JSON.stringify(e))}return null}async function C(e){console.log("INFO getLikes(): getting likes for address="+e);try{let t=await fetch(d+"/bigmaps/likes/keys?active=true&select=value&key.user="+T+"&key.author="+e);if(t.ok){let e=await t.json();if(e&&e.length>0)return console.log("INFO getLikes(): likes="+JSON.stringify(e[0])),e[0]}else console.log("ERROR getLikes(): can't get likes for address="+e)}catch(e){console.log("ERRROR getLikes(): "+JSON.stringify(e))}return null}async function U(e,t){try{const n=await c.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:r,parameters:{entrypoint:"like",value:JSON.parse('{ "prim": "Pair", "args": [ { "int": "'+t+'" }, { "string": "'+e+'" } ] }')}}]});if(n.transactionHash)return n.transactionHash}catch(e){console.log("ERROR like(): "+JSON.stringify(e))}return!1}async function F(e){console.log("INFO getFollowings(): getting followings for address="+e);let t=null;if(e===T&&b.has(T))return b.get(T);try{let n=await fetch(d+"/bigmaps/followings/keys?active=true&select=value&key="+e);if(n.ok){let s=await n.json();console.log("INFO getFollowings(): followings for address="+e+" f="+JSON.stringify(s)),t=s&&s.length>0?new Set(Object.values(s[0])):new Set,e===T&&b.set(e,t)}else console.log("ERROR getFollowings(): can't get followings for address="+e)}catch(e){console.log("ERRROR getFollowings(): "+e)}return t}async function H(e){let t,n=e.img?e.img.replace("ipfs://","https://ipfs.io/ipfs/"):"";if(e.website)try{t=new URL(e.website)}catch(e){}let a=s(e.address),i='<div class="p-3 mb-4"><article class="media" style="display: flex; height: 100%;"><figure class="media-left"><p class="image is-128x128"><img class="is-rounded" style="height:100%;" src="'+n+'"/></p></figure><div class="media-content" style="overflow: hidden;"><div class="content mb-0 is-size-4"><b>'+(e.name?e.name+"&nbsp;":"")+"</b>@"+e.username+'</div><div class="content is-small"><span id="txtUserAddress" class="user-address">'+a+'&nbsp;<span class="icon is-small"><i class="fa-regular fa-clone"></i></span></span></div><div class="content">'+e.desc.replaceAll("\n","<br/>")+'</div><div class="content">'+(e.location?'<span class="mr-5"><i class="fas fa-location-dot  pr-1"></i>'+e.location+"</span>":"")+(t?'<span class="mr-5"><i class="fas fa-globe pr-1"></i><a href="'+t.href+'">'+t.host+"</a></span>":"")+(e.twitter?'<span class="mr-5"><i class="fa-brands fa-twitter pr-1"></i><a href="https://twitter.com/'+e.twitter+'">'+e.twitter+"</a></span>":"")+'</div><div class="content"><small><i class="fa-regular fa-calendar pr-2"></i>'+new Date(Date.parse(e.reg_date)).toDateString().slice(4)+'</small></div><div class="content"><div class="tags"><span class="tag is-info is-normal"><i class="fa-regular fa-message"></i>&nbsp;Tweets&nbsp;:&nbsp;<b id="nposts">0</b></span><span class="tag is-danger is-normal"><i class="fa-solid fa-heart"></i>&nbsp;Likes&nbsp;:&nbsp;<b id="nlikes">0</b></span><span class="tag is-primary is-normal"><i class="fas fa-users"></i>&nbsp;Followers&nbsp;:&nbsp;<b id="nfollowers">0</b></span></div></div></div></article>';if(N()&&T!==e.address){i+='<div class="buttons is-justify-content-flex-end mt-3">';let t=await F(T);if(t){let n=t.has(e.username);i+='<button id="btnFollow" class="button is-primary is-rounded"'+(n||e.pol_follow!==E?"":' disabled=""')+">"+(n?"Unfollow":"Follow")+"</button>"}i+='<button id="btnDonate" class="button is-info is-rounded">Donate</button></div>'}return i+="</div>",i}function x(e,t,n){let s=e.img?e.img.replace("ipfs://","https://ipfs.io/ipfs/"):"";return'<article class="media px-3 pt-0 tweet" data-address="'+e.address+'" data-username="'+e.username+'" data-mid="'+t.i+'" onclick="event.stopPropagation();window.location.search=\'u='+e.username+"&m="+t.i+'\';"><figure class="media-left pt-3"><p class="image is-32x32"><img class="is-rounded" style="height:100%;" src="'+s+'"></p></figure><div class="media-content pt-3"><div class="content">'+(n?'<span class="pl-1 pr-2"><span class="icon is-small"><i class="fas fa-retweet"></i></span></span>':"")+'<span class="tweet-name" onclick="event.stopPropagation();window.location.search=\'u='+e.username+"';\"><b>"+(e.name?e.name+"&nbsp;":"")+"</b>@"+e.username+'</span><small class="has-text-grey"> &middot; '+new Date(Date.parse(t.t)).toLocaleString()+"</small>"+(T===t.a&&Date.parse(t.t)+v.get(w)>Date.now()?'<button class="button is-ghost is-rounded is-shadowless tweet-btn-edit is-pulled-right" tabindex="-1" style="position:relative;top:-8px;"><span class="icon is-small has-text-black"><i class="fa-regular fa-pen-to-square"></i></span></button>':"")+'</div><div id="msg_'+e.address+"_"+t.i+'" class="content">'+D(t.m)+'</div><nav class="level mb-1 is-mobile" style="overflow:hidden;"><div class="level-left"><div class="level-item mr-5"><button class="button is-ghost is-rounded is-shadowless tweet-btn-reply" tabindex="0"><span class="icon is-small has-text-info"><i class="fa-regular fa-comment"></i></span></button><span id="replyVal_'+e.address+"_"+t.i+'" class="ml-1 is-size-7">'+(t.r>0?t.r:"&nbsp;")+'</span></div><div class="level-item mr-5 px-0"><button class="button is-ghost is-rounded is-shadowless tweet-btn-retweet" tabindex="0"><span class="icon is-small"><i class="fas fa-retweet"></i></span></button><span id="retweetVal_'+e.address+"_"+t.i+'" class="is-size-7">'+(t.c>0?t.c:"&nbsp;")+'</span></div><div class="level-item mr-5 px-0"><button class="button is-ghost is-rounded is-shadowless tweet-btn-like" tabindex="0"><span class="icon is-small has-text-danger"><i id="likeImg_'+e.address+"_"+t.i+'" class="fa-regular fa-heart"></i></span></button><span id="likeVal_'+e.address+"_"+t.i+'" class="is-size-7">'+(t.l>0?t.l:"&nbsp;")+'</span></div><div class="level-item"><button class="button is-ghost is-rounded is-shadowless tweet-btn-link" tabindex="0"><span class="icon is-small has-text-info-dark"><i class="fas fa-link"></i></span></button></div></div></nav></div></article>'}function J(e,t,n){let s=e.img?e.img.replace("ipfs://","https://ipfs.io/ipfs/"):"",a=e.name?e.name+"&nbsp;":"",i=new Date(Date.parse(t.t)).toLocaleString(),o=D(t.m);const l=document.getElementById("t-reply").content.cloneNode(!0);if(l.querySelector(".js-img").setAttribute("src",s),l.querySelector(".tweet-name").setAttribute("onclick","event.stopPropagation();window.location.search='u="+e.username+"'"),l.querySelector(".js-name").innerHTML=a,l.querySelector(".js-username").innerText=e.username,l.querySelector(".js-date").innerText=i,l.querySelector(".js-msg").innerHTML=o,n){let e=l.querySelector("article");e&&e.setAttribute("data-mid",n.i);let s=l.querySelector(".tweet-btn-edit");s&&(T===t.a&&Date.parse(t.t)+v.get(w)>Date.now()?(e.setAttribute("data-address",t.a),e.setAttribute("data-pa",n.ta),e.setAttribute("data-pid",n.ti),s.classList.remove("is-hidden")):s.classList.add("is-hidden"))}return l}function D(e){let t={};try{t=function(e){return JSON.parse(n(e))}(e)}catch(s){t.t=n(e)}let s="";if(t.hasOwnProperty("t")&&t.t&&t.t.length>0){const e=new URL(document.location.href);s=t.t,s=s.replaceAll(/(^|\s)@(\w{3,15})\b/gm,((t,n,s)=>n+"<a href='"+e.origin+e.pathname+"?u="+s.toLowerCase()+"'>@"+s+"</a>")),s=s.replaceAll(/(^|\s)(((http|ftp|ftps|https):\/\/)([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:\/~+#-_]*[\w@?^=%&\/~+#-_]))/gm,((e,t,n)=>t+"<a href='"+n+"' target='_blank' onclick='event.stopPropagation();'>"+n+"</a>")),s=s.replaceAll("\n","<br/>")}if(t.hasOwnProperty("i")&&t.i)try{new URL(t.i),s+="<figure class='image mx-0 mt-5'><img src='"+t.i+"'></figure>"}catch(e){}else if(t.hasOwnProperty("y")&&t.y)try{new URL(t.y),s+=t.y.replace(/^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube(-nocookie)?\.com|youtu.be))(\/(?:[\w\-]+\?v=|embed\/|v\/)?)([\w\-]+)(\S+)?$/gm,(e=>{let t=e.match("^(?:https?:)?//[^/]*(?:youtube(?:-nocookie)?.com|youtu.be).*[=/]([-\\w]{11})(?:\\?|=|&|$)");return t&&(e="<figure class='image mx-0 mt-5 is-16by9'><iframe class='has-ratio' width='640' height='360' src='https://www.youtube.com/embed/"+t[1]+"' frameborder='0' allowfullscreen></iframe>"+e+"</figure>"),e}))}catch(e){}return s}const z={message:"Connect your wallet",type:"is-danger"},q={message:"That TwiTez user doesn't exist",type:"is-danger"},j={message:"Tweet doesn't exist",type:"is-danger"},V={message:"Copied to clipboard",type:"is-info"};function $(e){let t="";e&&e.length>0&&(t=" with ID <a href='https://"+l+".tzkt.io/"+e+"' target='_blank'>"+s(e)+"</a>"),bulmaToast.toast({message:"Your request is processing"+t,duration:5e3,type:"is-info"})}function G(e){if(navigator.clipboard)return navigator.clipboard.writeText(e).then((function(){}),(function(e){console.log("ERROR copyToClipboard(): "+e)})),void bulmaToast.toast(V);let t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),bulmaToast.toast(V)}catch(e){}document.body.removeChild(t)}async function W(){let e=document.getElementById("iSearch").value;e=e.trim(),e&&(e=e.toLowerCase(),window.location.search="u="+e)}function Y(e){document.getElementById("tUsername").innerHTML=e,document.getElementById("dLogin").classList.add("is-hidden"),document.getElementById("dUser").classList.remove("is-hidden")}async function K(){let e=document.getElementById("iUsername").value,t="";if(e&&e.length>=v.get(m)&&e.length<=v.get(g)){e=e.toLowerCase();for(let n=0;n<e.length;n++)if(-1==="abcdefghijklmnopqrstuvwxyz0123456789_".indexOf(e.charAt(n))){t='Invalid character "<b>'+e[n]+'</b>" at position '+(n+1);break}}else t="Username length has to be in ["+v.get(m)+".."+v.get(g)+"]";if(t&&t.length>0)bulmaToast.toast({message:t,type:"is-danger"});else{e=e.toLowerCase();let t=await async function(e){if(await S(),await k(),!B())return console.log("ERROR register(): "+L),null;e=e.toLowerCase();try{const t=await c.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:r,parameters:{entrypoint:"register_user",value:JSON.parse('{"string":'+JSON.stringify(e)+"}")}}]});if(t.transactionHash)return h.set(e,T),t.transactionHash}catch(e){console.log("ERROR register(): "+JSON.stringify(e))}return null}(e);t&&X(t,e),Q()}}async function X(e,t,n){document.getElementById("mStatus").classList.add("is-active"),n||(n=Date.now());let s=await async function(e){console.log("INFO getTxStatus(): getting status for "+e);try{let t=await fetch("https://api."+l+".tzkt.io/v1/operations/transactions/"+e+"/status");if(t.ok){const e=await t.text();if(console.log("INFO getTxStatus(): status="+e),e)return JSON.parse(e)}else console.log("ERROR getTxStatus(): can't get status for "+e)}catch(e){console.log("ERRROR getTxStatus(): "+e+" "+JSON.stringify(e))}return null}(e);s?(await A(!0),N()?(Y((await M(T)).username),bulmaToast.toast({message:"Sign Up process has been completed successfully",duration:5e3,type:"is-success"})):(Z(),bulmaToast.toast({message:"User data can not be loaded",duration:6e3,type:"is-danger"})),document.getElementById("mStatus").classList.remove("is-active")):!1===s?(document.getElementById("mStatus").classList.remove("is-active"),bulmaToast.toast({message:"Sign Up process has not been completed",duration:6e3,type:"is-danger"})):Date.now()-n<3e4?setTimeout(X,3e3,e,t,n):(document.getElementById("mStatus").classList.remove("is-active"),bulmaToast.toast({message:"Sign Up process takes much time...",duration:6e3,type:"is-warning"}))}function Q(){document.getElementById("mSignUp").classList.remove("is-active")}function Z(){document.getElementById("dUserMenu").classList.remove("is-active"),document.getElementById("tUsername").innerHTML="",document.getElementById("dUser").classList.add("is-hidden"),document.getElementById("dLogin").classList.remove("is-hidden")}function ee(){document.getElementById("mFollowing").classList.remove("is-active")}function te(){document.getElementById("bProfileEdit").classList.add("is-hidden"),document.getElementById("bProfilePreview").classList.remove("is-hidden"),document.getElementById("dProfilePreview").classList.add("is-hidden"),document.getElementById("dProfileEdit").classList.remove("is-hidden")}function ne(){document.getElementById("mProfile").classList.remove("is-active")}function se(){document.getElementById("mSettings").classList.remove("is-active")}function ae(){let e=event.target;document.querySelectorAll(".js-donate-btn").forEach((function(e){e.classList.remove("is-active"),e.classList.remove("is-info")})),e.classList.add("is-active"),e.classList.add("is-info"),document.getElementById("mmDonationAmount").value=e.getAttribute("data-amount")}async function ie(e,t,s){if(N()){if(t&&s?(document.getElementById("mNewTweet").setAttribute("data-pa",t),document.getElementById("mNewTweet").setAttribute("data-pid",s),document.getElementById("mntTitleTweet").classList.add("is-hidden"),document.getElementById("mntTitleReply").classList.remove("is-hidden")):(document.getElementById("mNewTweet").removeAttribute("data-pa"),document.getElementById("mNewTweet").removeAttribute("data-pid"),document.getElementById("mntTitleTweet").classList.remove("is-hidden"),document.getElementById("mntTitleReply").classList.add("is-hidden")),e){let a=t&&s?await async function(e){console.log("INFO getReply(): getting reply for id="+e);try{let t=await fetch(d+"/bigmaps/replies/keys/?key.i="+e+"&active=true&select=value");if(t.ok){let e=await t.json();if(console.log("INFO getReply(): tweet="+JSON.stringify(e)),e&&e.length>0)return e[0]}else console.log("ERROR getReply(): can't get reply for id="+e)}catch(e){console.log("ERRROR getReply(): "+JSON.stringify(e))}return null}(e):await P(T,e);if(!a)return void bulmaToast.toast(j);{document.getElementById("mNewTweet").setAttribute("data-mid",e);let t={};try{t=JSON.parse(n(a.m))}catch(e){t.t=n(a.m)}t.hasOwnProperty("t")&&t.t&&t.t.length>0&&(document.getElementById("tNewTweet").value=t.t);const s=document.getElementById("selMediaType"),i=document.getElementById("iMediaLink");t.hasOwnProperty("i")&&t.i?(s.value="i",s.dispatchEvent(new Event("change")),i.value=t.i):t.hasOwnProperty("y")&&t.y&&t.y.length>0&&(s.value="y",s.dispatchEvent(new Event("change")),i.value=t.y)}document.getElementById("mntTitleNew").classList.add("is-hidden"),document.getElementById("mntTitleEdit").classList.remove("is-hidden")}else document.getElementById("mntTitleNew").classList.remove("is-hidden"),document.getElementById("mntTitleEdit").classList.add("is-hidden"),document.getElementById("tNewTweet").value="",document.getElementById("selMediaType").value="",document.getElementById("selMediaType").dispatchEvent(new Event("change")),document.getElementById("mNewTweet").removeAttribute("data-mid");document.getElementById("mNewTweet").classList.add("is-active"),oe()}else bulmaToast.toast(z)}function oe(){document.getElementById("dNewTweetPreview").innerHTML="",document.getElementById("bNewTweetEdit").classList.add("is-hidden"),document.getElementById("bNewTweetPreview").classList.remove("is-hidden"),document.getElementById("dNewTweetPreview").classList.add("is-hidden"),document.getElementById("dNewTweetEdit").classList.remove("is-hidden"),document.getElementById("tNewTweet").focus()}function le(){document.getElementById("mNewTweet").classList.remove("is-active")}async function re(){if(event.stopPropagation(),!N())return void bulmaToast.toast(z);let e=event.target.closest("article");if(e){let t=e.getAttribute("data-address"),n=e.getAttribute("data-mid"),s=e.getAttribute("data-pa"),a=e.getAttribute("data-pid");t===T&&ie(n,s,a)}}async function de(){event.stopPropagation();let e=event.target.closest("article");e||(e=event.target.closest("nav")),e&&ie(null,e.getAttribute("data-address"),e.getAttribute("data-mid"))}async function ce(){if(event.stopPropagation(),!N())return void bulmaToast.toast(z);let e=event.target.closest("article");e||(e=event.target.closest("nav"));let t=e.getAttribute("data-address"),n=e.getAttribute("data-mid"),s=await M(t);console.log("author="+JSON.stringify(s));let a=await async function(e,t){try{const n=await c.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:r,parameters:{entrypoint:"retweet",value:JSON.parse('{ "prim": "Pair", "args": [ { "string": "'+e+'" }, { "int": "'+t+'" } ] }')}}]});if(n.transactionHash)return n.transactionHash}catch(e){console.log("ERROR retweet(): "+JSON.stringify(e))}return!1}(t,n);if(a){$();let e=document.getElementById("retweetVal_"+t+"_"+n);if(e){let t=parseInt(e.innerHTML);t=isNaN(t)?1:t+1,e.innerHTML=t>0?t:"&nbsp;"}}}async function me(){if(event.stopPropagation(),!N())return void bulmaToast.toast(z);let e=event.target.closest("article");if(e){let t=e.getAttribute("data-address"),n=e.getAttribute("data-username"),s=e.getAttribute("data-mid");if(isNaN(s)||parseInt(s)<0)return;if(await U(n,s)){$();let e=document.getElementById("likeImg_"+t+"_"+s),n=document.getElementById("likeVal_"+t+"_"+s),a=document.getElementById("nlikes"),i=parseInt(n.innerHTML),o=a?parseInt(a.innerHTML):0;e.classList.contains("fa-regular")?(i=isNaN(i)?1:i+1,o=isNaN(o)?1:o+1):(i=isNaN(i)?0:i-1,o=isNaN(o)?0:o-1),e&&(e.classList.toggle("fa-regular"),e.classList.toggle("fa-solid")),n&&(n.innerHTML=i>0?i:"&nbsp;"),a&&(a.innerHTML=o)}}}async function ge(){event.stopPropagation();let e=event.target.closest("article");if(e||(e=event.target.closest("nav")),e){let t=new URL(window.location);t.search="u="+e.getAttribute("data-username")+"&m="+e.getAttribute("data-mid"),G(t.toString())}}async function ue(e){e.querySelectorAll(".tweet-btn-reply").forEach((function(e){e.onclick=de})),e.querySelectorAll(".tweet-btn-retweet").forEach((function(e){e.onclick=ce})),e.querySelectorAll(".tweet-btn-like").forEach((function(e){e.onclick=me})),e.querySelectorAll(".tweet-btn-link").forEach((function(e){e.onclick=ge})),e.querySelectorAll(".tweet-btn-edit").forEach((function(e){e.onclick=re}))}async function ye(e){if(N()&&e.size>0)for(let t of e){let e=await C(t);if(e)for(let n of e){let e=document.getElementById("likeImg_"+t+"_"+n);e&&(e.classList.toggle("fa-regular"),e.classList.toggle("fa-solid"))}}}function pe(){document.getElementById("dMainPage").classList.add("is-hidden"),document.getElementById("dMainNewTweets").innerHTML="",document.getElementById("dContent").classList.add("is-hidden"),document.getElementById("dUserContent").innerHTML="",document.getElementById("dMessages").innerHTML="",document.getElementById("dTweetContent").classList.add("is-hidden"),document.getElementById("dTweet").innerHTML="",document.getElementById("dReplies").innerHTML=""}function fe(e,t,n){let s={t:void 0,i:void 0,y:void 0,a:void 0,v:void 0};if(e&&e.length>0&&(s.t=function(e){let t=document.createElement("p");return t.innerHTML=e,t.textContent}(e)),t&&n)switch(n){case"i":s.i=t;break;case"y":s.y=t;break;case"a":s.a=t;break;case"v":s.v=t}return console.log("INFO codeMsgData(): msg="+JSON.stringify(s)),JSON.stringify(s)}bulmaToast.setDefaults({duration:6e3,position:"bottom-left",dismissible:!0,animate:{in:"zoomIn",out:"zoomOut"}}),document.getElementById("btnSearch").addEventListener("click",(()=>W())),document.getElementById("iSearch").addEventListener("keyup",(function(e){e.preventDefault(),13===e.keyCode&&W()})),document.addEventListener("DOMContentLoaded",(async function(){await A(!0),N()?Y((await M(T)).username):Z();let e=new URL(document.location.href);if(e){let t=e.searchParams.get("u");if(t&&t.length>0){"@"===t[0]&&(t=t.substring(1)),t=decodeURIComponent(t);let n=await _(t);console.log("INFO onLoad(): username="+t+" address="+n);let s=e.searchParams.get("m");return void(s?(s=decodeURIComponent(s),console.log("INFO onLoad(): msgId="+s),await async function(e,t){let n,s;if(console.log("INFO showReplies(): show replies for address="+e+" id="+t),pe(),document.getElementById("dTweetNavPanel").classList.add("is-hidden"),document.getElementById("dTweetContentError").classList.add("is-hidden"),document.getElementById("dTweetContentLoading").classList.remove("is-hidden"),document.getElementById("dTweetContent").classList.remove("is-hidden"),e&&t&&(n=await M(e),s=await P(e,t)),n&&s){let a=function(e,t){return'<article class="media px-3 pt-3"><figure class="media-left"><p class="image is-32x32"><img class="is-rounded" style="height:100%;" src="'+(e.img?e.img.replace("ipfs://","https://ipfs.io/ipfs/"):"")+'"></p></figure><div class="media-content"><div class="content"><span class="tweet-name" onclick="event.stopPropagation();window.location.search=\'u='+e.username+"';\"><b>"+(e.name?e.name+"&nbsp;":"")+"</b>@"+e.username+'</span><small class="has-text-grey"> &middot; '+new Date(Date.parse(t.t)).toLocaleString()+'</small></div><div class="content">'+D(t.m)+'</div><nav class="level pt-5 pb-3 is-mobile" style="overflow: hidden;" data-address="'+e.address+'" data-username="'+e.username+'" data-mid="'+t.i+'"><div class="level-left"><div class="level-item mr-6"><hr class="p-0 m-0"/><span id="replyVal_'+e.address+"_"+t.i+'" class="has-text-weight-bold">'+t.r+'</span><span class="has-text-grey">&nbsp;replies</span></div><div class="level-item mr-6"><hr class="p-0 m-0"/><span id="retweetVal_'+e.address+"_"+t.i+'" class="has-text-weight-bold">'+t.c+'</span><span class="has-text-grey">&nbsp;retweets</span></div><div class="level-item"><span id="likeVal_'+e.address+"_"+t.i+'" class="has-text-weight-bold">'+t.l+'</span><span class="has-text-grey">&nbsp;likes</span></div></div></nav></div></article>'}(n,s);document.getElementById("dTweet").innerHTML=a,document.getElementById("dTweetNavPanel").classList.remove("is-hidden");let i=document.getElementById("dTweetNav");i.setAttribute("data-username",n.username),i.setAttribute("data-address",n.address),i.setAttribute("data-mid",t);let o=await async function(e,t){console.log("INFO getReplies(): getting replies for address="+e+" id="+t);try{let n=await fetch(d+"/bigmaps/replies/keys/?key.ta="+e+"&key.ti="+t+"&active=true&select=key,value");if(n.ok){let e=await n.json();if(console.log("INFO getReplies(): replies="+JSON.stringify(e)),e&&e.length>0)return e}else console.log("ERROR getReplies(): can't get replies for address="+e+" id="+t)}catch(e){console.log("ERRROR getReplies(): "+JSON.stringify(e))}return null}(e,t);if(o){let e=document.getElementById("dReplies");for(let t of o)n=await M(t.value.a),e.append(J(n,t.value,t.key));e.querySelectorAll(".tweet-btn-edit").forEach((function(e){e.onclick=re}))}if(N()){let n=await C(e);if(n)for(let e of n)if(e===t){let e=document.getElementById("btnTweetLikeImg");e&&(e.classList.toggle("fa-regular"),e.classList.toggle("fa-solid"));break}}}else document.getElementById("dTweetContentError").classList.remove("is-hidden");document.getElementById("dTweetContentLoading").classList.add("is-hidden")}(n,s)):await async function(e){let t;if(console.log("INFO showUserTweets(): show content for address="+e),pe(),document.getElementById("dContentError").classList.add("is-hidden"),document.getElementById("dContentLoading").classList.remove("is-hidden"),document.getElementById("dContent").classList.remove("is-hidden"),e&&(t=await M(e)),t){let n=await H(t)+"<hr class='p-0 m-0'/>";document.getElementById("dUserContent").innerHTML=n;let s=document.getElementById("txtUserAddress");s&&s.addEventListener("click",(()=>G(t.address)));let a=document.getElementById("btnDonate");a&&a.addEventListener("click",(()=>function(e){e&&(document.getElementById("dUserMenu").classList.remove("is-active"),document.getElementById("mmDonationAddress").value=e,document.getElementById("mDonate").classList.add("is-active"))}(t.address)));let i=document.getElementById("btnFollow");i&&i.addEventListener("click",(()=>async function(e){if(!N())return void bulmaToast.toast(z);if(!e)return;e=e.toLowerCase();let t=await async function(e){e=e.toLowerCase();try{const t=await c.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:r,parameters:{entrypoint:"follow",value:JSON.parse('{"string":'+JSON.stringify(e)+"}")}}]});if(t.transactionHash)return t.transactionHash}catch(e){console.log("ERROR follow(): "+JSON.stringify(e))}return!1}(e);if(t){$();let t=parseInt(document.getElementById("nfollowers").innerHTML),n=document.getElementById("btnFollow"),s=await F(T);if(s){if(s.has(e)){s.delete(e),t=isNaN(t)?0:t-1,n.innerHTML="Follow";let a=await M(await _(e));a&&a.pol_follow===E&&n.setAttribute("disabled","")}else s.add(e),t=isNaN(t)?1:t+1,n.innerHTML="Unfollow";b.set(T,s)}document.getElementById("nfollowers").innerHTML=t}}(t.username)));let o=await async function(e){console.log("INFO getUserTotal(): getting total info for address="+e);try{let t=await fetch(d+"/bigmaps/users_total/keys/?key="+e+"&active=true&select=value");if(t.ok){let e=await t.json();if(e)return console.log("INFO getUserTotal(): total="+JSON.stringify(e[0])),e[0]}else console.log("ERROR getUserTotal(): can't get total info for address="+e)}catch(e){console.log("ERRROR getUserTotal(): "+e)}return null}(t.address);o&&(document.getElementById("nposts").innerHTML=o.tweets,document.getElementById("nlikes").innerHTML=o.likes,document.getElementById("nfollowers").innerHTML=o.followers),n="";let l=await async function(e){console.log("INFO getTweets(): getting tweets for address="+e);try{let t=await fetch(d+"/bigmaps/tweets/keys/?key.a="+e+"&active=true&select=value");if(t.ok){let e=await t.json();if(console.log("INFO getTweets(): tweets="+JSON.stringify(e)),e&&e.length>0)return e}else console.log("ERROR getTweets(): can't get tweets for address="+e)}catch(e){console.log("ERRROR getTweets(): "+JSON.stringify(e))}return null}(e);if(l){let e=new Set;for(let s of l)e.add(s.a),n=""===s.m?x(await M(s.a),await P(s.a,s.i),!0)+"<hr class='p-0 m-0'/>"+n:x(t,s)+"<hr class='p-0 m-0'/>"+n;let s=document.getElementById("dMessages");s.innerHTML=n,ue(s),await ye(e)}}else document.getElementById("dContentError").classList.remove("is-hidden");document.getElementById("dContentLoading").classList.add("is-hidden")}(n))}}console.log("INFO onLoad(): show last tweets"),await async function(){console.log("INFO showLastTweets(): show last tweets"),pe(),document.getElementById("tabNewTweets").classList.add("is-active"),document.getElementById("dMainPage").classList.remove("is-hidden");let e="",t=await async function(e){console.log("INFO getLastTweets(): getting last tweets");try{let e=await fetch(d+'/bigmaps/tweets/keys/?sort.desc=id&value.m.ne=""&select=key,value&limit=25');if(e.ok){let t=await e.json();if(console.log("INFO getLastTweets(): last tweets="+JSON.stringify(t)),t&&t.length>0)return t}else console.log("ERROR getLastTweets(): can't get last tweets")}catch(e){console.log("ERRROR getLastTweets(): "+JSON.stringify(e))}return null}();if(t){let n=new Set;for(let s of t)n.add(s.key.a),e+=x(await M(s.key.a),s.value)+"<hr class='p-0 m-0'/>";let s=document.getElementById("dMainNewTweets");s.innerHTML=e,ue(s),await ye(n)}}()})),document.getElementById("btnLogIn").addEventListener("click",(()=>async function(){await A(!1),B()?N()?window.location.reload():(bulmaToast.toast(q),Z()):(bulmaToast.toast(z),Z())}())),document.getElementById("iUsername").addEventListener("keyup",(function(e){e.preventDefault(),13===e.keyCode?K():27===e.keyCode&&Q()})),document.getElementById("bSignUpSignup").addEventListener("click",(()=>K())),document.getElementById("btnSignUp").addEventListener("click",(()=>(document.getElementById("mSignUp").classList.add("is-active"),document.getElementById("iUsername").value="",void document.getElementById("iUsername").focus()))),document.getElementById("bSignUpClose").addEventListener("click",(()=>Q())),document.getElementById("bSignUpCancel").addEventListener("click",(()=>Q())),document.getElementById("btnLogout").addEventListener("click",(()=>async function(){await S(),Z(),window.location.reload()}())),document.getElementById("btnMyTweets").addEventListener("click",(()=>async function(){if(N()){document.getElementById("dUserMenu").classList.remove("is-active"),document.getElementById("iSearch").value="";let e=await M(T);window.location.search="u="+e.username}}())),document.getElementById("btnFollowing").addEventListener("click",(()=>async function(){document.getElementById("dUserMenu").classList.remove("is-active"),document.getElementById("mFollowingContent").innerHTML="",document.getElementById("mFollowingLoading").classList.remove("is-hidden");let e="";document.getElementById("mFollowing").classList.add("is-active");let t=await F(T);if(t&&t.size>0){let n=0;for(let s of t)n++,n>1&&(e+=", "),e+=n%2==1?"<i class='fa-regular fa-user'></i>":"<i class='fa-solid fa-user'></i>",e+=" <a href='./index.html?u="+s+"'>"+s+"</a>"}document.getElementById("mFollowingLoading").classList.add("is-hidden"),document.getElementById("mFollowingContent").innerHTML=e}())),document.getElementById("bFollowingClose").addEventListener("click",(()=>ee())),document.getElementById("bFollowingCancel").addEventListener("click",(()=>ee())),document.getElementById("btnProfile").addEventListener("click",(()=>(document.getElementById("dUserMenu").classList.remove("is-active"),void async function(){if(!N())return void bulmaToast.toast(z);let e=await M(T);document.getElementById("prUsername").value=e.username,document.getElementById("prName").value=e.name,document.getElementById("prImg").value=e.img,document.getElementById("prDesc").value=e.desc,document.getElementById("prLocation").value=e.location,document.getElementById("prWebsite").value=e.website,document.getElementById("prTwitter").value=e.twitter,document.getElementById("mProfile").classList.add("is-active"),te()}()))),document.getElementById("bProfileEdit").addEventListener("click",(()=>te())),document.getElementById("bProfilePreview").addEventListener("click",(()=>async function(){if(!N())return void bulmaToast.toast(z);let e=await M(T);var t={address:e.address,username:e.username,reg_date:e.reg_date,name:document.getElementById("prName").value,img:document.getElementById("prImg").value,desc:document.getElementById("prDesc").value,location:document.getElementById("prLocation").value,twitter:document.getElementById("prTwitter").value,website:document.getElementById("prWebsite").value};let n=await H(t);document.getElementById("dProfilePreview").innerHTML=n,document.getElementById("bProfilePreview").classList.add("is-hidden"),document.getElementById("bProfileEdit").classList.remove("is-hidden"),document.getElementById("dProfileEdit").classList.add("is-hidden"),document.getElementById("dProfilePreview").classList.remove("is-hidden")}())),document.getElementById("bProfileSave").addEventListener("click",(()=>async function(){let e=document.getElementById("prName").value,n=document.getElementById("prImg").value,s=document.getElementById("prDesc").value,a=document.getElementById("prLocation").value,i=document.getElementById("prWebsite").value,o=document.getElementById("prTwitter").value;if(e=e.trim(),e&&(e.length<v.get(u)||e.length>v.get(y)))bulmaToast.toast({type:"is-danger",message:"Name length has to be in ["+v.get(u)+".."+v.get(y)+"]"});else{if(n=n.trim(),a=a.trim(),i=i.trim(),i.length>0)try{i=new URL(i).toString()}catch(e){return void bulmaToast.toast({type:"is-danger",message:"Invalid website URL"})}o=o.trim(),o.length>0&&!/^@?(\w){4,15}$/.test(o)?bulmaToast.toast({type:"is-danger",message:"Invalid twitter username"}):await async function(e,n,s,a,i,o){if(!B())return console.log("ERROR profile(): "+L),!1;let l=I.get(T);if(!l)return console.log("ERROR profile(): "+R),!1;let d="";if(l.desc!==s&&(d.length>0&&(d+=","),d+='{"prim":"Elt","args":[{"string":"desc" },{"bytes":"'+t(s)+'"}]}'),l.img!==n&&(d.length>0&&(d+=","),d+='{"prim":"Elt","args":[{"string":"img" },{"bytes":"'+t(n)+'"}]}'),l.location!==a&&(d.length>0&&(d+=","),d+='{"prim":"Elt","args":[{"string":"loc" },{"bytes":"'+t(a)+'"}]}'),l.name!==e&&(d.length>0&&(d+=","),d+='{"prim":"Elt","args":[{"string":"name" },{"bytes":"'+t(e)+'"}]}'),l.twitter!==o&&(d.length>0&&(d+=","),d+='{"prim":"Elt","args":[{"string":"twitter" },{"bytes":"'+t(o)+'"}]}'),l.website!==i&&(d.length>0&&(d+=","),d+='{"prim":"Elt","args":[{"string":"web" },{"bytes":"'+t(i)+'"}]}'),d.length>0)try{if((await c.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:r,parameters:{entrypoint:"set_props",value:JSON.parse("["+d+"]")}}]})).transactionHash)return l.name=e,l.img=n,l.desc=s,l.location=a,l.twitter=o,l.website=i,I.set(T,l),!0}catch(e){console.log("ERROR profile(): "+e+" "+JSON.stringify(e))}else console.log("WARNING profile(): no new data");return!1}(e,n,s,a,i,o)&&(ne(),$())}}())),document.getElementById("bProfileClose").addEventListener("click",(()=>ne())),document.getElementById("bProfileCancel").addEventListener("click",(()=>ne())),document.getElementById("btnSettings").addEventListener("click",(()=>(document.getElementById("dUserMenu").classList.remove("is-active"),void async function(){if(!N())return void bulmaToast.toast(z);let e=await M(T);document.getElementById("selFollow").value=e.pol_follow>0?1:e.pol_follow,document.getElementById("mSettings").classList.add("is-active")}()))),document.getElementById("bSettingsSave").addEventListener("click",(()=>async function(){let e=document.getElementById("selFollow").value,t=await async function(e){if(!B())return console.log("ERROR policies(): "+L),!1;let t=I.get(T);if(!t)return console.log("ERROR policies(): "+R),!1;if(e=String(e),t.pol_follow!==e)try{if((await c.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:r,parameters:{entrypoint:"set_policies",value:JSON.parse('{"int":"'+e+'"}')}}]})).transactionHash)return t.pol_follow=e,I.set(T,t),!0}catch(e){console.log("ERROR policies(): "+e+" "+JSON.stringify(e))}else console.log("WARNING policies(): no new data");return!1}(e);t&&$(),se()}())),document.getElementById("bSettingsClose").addEventListener("click",(()=>se())),document.getElementById("bSettingsCancel").addEventListener("click",(()=>se())),document.querySelectorAll(".js-donate-btn").forEach((function(e){e.onclick=ae})),document.getElementById("bDonate").addEventListener("click",(()=>async function(){let e=document.getElementById("mmDonationAmount").value;if(e&&e>0){let t=await async function(e,t){t=function(e,t){let n=String(e),s=Number(6),a=n.indexOf(".");return a<0?n+"0".repeat(s):n.substring(0,a)+(n.length-a-1>=s?n.substring(a+1,a+1+s):n.substring(a+1)+"0".repeat(s-(n.length-a-1)))}(t);try{const n=await c.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:t,destination:e}]});if(n.transactionHash)return n.transactionHash}catch(e){console.log("ERROR send(): "+JSON.stringify(e))}return!1}(document.getElementById("mmDonationAddress").value,e);t&&$(t),document.getElementById("mDonate").classList.remove("is-active")}else bulmaToast.toast({message:"Enter <b>amount</b> in (0, inf)",type:"is-danger"})}())),document.getElementById("btnNewTweet").addEventListener("click",(()=>(document.getElementById("dUserMenu").classList.remove("is-active"),void ie()))),document.getElementById("selMediaType").addEventListener("change",(()=>function(){let e=document.getElementById("selMediaType").value;const t=document.getElementById("iMediaLink"),n=document.getElementById("sMediaIcon");switch(t.value="",e){case"":t.disabled=!0,t.placeholder="",n.innerHTML="";break;case"i":t.disabled=!1,t.placeholder="Image URL (http:// https:// ipfs://) ...",n.innerHTML='<i class="fa-regular fa-image"></i>';break;case"y":t.disabled=!1,t.placeholder="Youtube video URL ...",n.innerHTML='<i class="fa-brands fa-youtube"></i>'}}())),document.getElementById("bNewTweetEdit").addEventListener("click",(()=>oe())),document.getElementById("bNewTweetPreview").addEventListener("click",(()=>async function(){if(!N())return void bulmaToast.toast(z);let e=document.getElementById("tNewTweet").value.trim(),n=document.getElementById("iMediaLink").value.trim(),s=document.getElementById("selMediaType").value;if(!e&&!n)return void bulmaToast.toast({type:"is-danger",message:"Tweet can not be empty"});if(n)try{new URL(n)}catch(e){return void bulmaToast.toast({type:"is-danger",message:"Invalid media URL"})}let a={t:new Date,m:t(fe(e,n,s))};document.getElementById("dNewTweetPreview").innerHTML="",document.getElementById("dNewTweetPreview").append(J(await M(T),a)),document.getElementById("bNewTweetPreview").classList.add("is-hidden"),document.getElementById("bNewTweetEdit").classList.remove("is-hidden"),document.getElementById("dNewTweetEdit").classList.add("is-hidden"),document.getElementById("dNewTweetPreview").classList.remove("is-hidden")}())),document.getElementById("bNewTweetSend").addEventListener("click",(()=>async function(){let e=document.getElementById("tNewTweet").value.trim(),n=document.getElementById("iMediaLink").value.trim(),s=document.getElementById("selMediaType").value;if(!e&&!n)return void bulmaToast.toast({type:"is-danger",message:"Tweet can not be empty"});if(n)try{new URL(n)}catch(e){return void bulmaToast.toast({type:"is-danger",message:"Invalid media URL"})}let a=fe(e,n,s);if(console.log("INFO sendNewTweet(): tweet="+a),a&&a.length>=v.get(p)&&a.length<=v.get(f)){let e,n=document.getElementById("mNewTweet").getAttribute("data-mid"),s=document.getElementById("mNewTweet").getAttribute("data-pa"),i=document.getElementById("mNewTweet").getAttribute("data-pid");if(e=s&&i?n?await async function(e,n,s,a){if(!B())return console.log("ERROR update_reply(): "+L),!1;if(!N())return console.log("ERROR update_reply(): "+R),!1;try{const i=await c.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:r,parameters:{entrypoint:"update_reply",value:JSON.parse('{"prim":"Pair","args":[{"prim":"Pair","args":[{"int":"'+a+'"},{"bytes":"'+t(s)+'"}]},{"prim":"Pair","args":[{"string":"'+e+'"},{"int":"'+n+'"}]}]}')}}]});if(i.transactionHash)return i.transactionHash}catch(e){console.log("ERROR update_reply(): "+JSON.stringify(e))}return!1}(s,i,a,n):await async function(e,n,s){if(!B())return console.log("ERROR reply(): "+L),!1;if(!N())return console.log("ERROR reply(): "+R),!1;try{const a=await c.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:r,parameters:{entrypoint:"reply",value:JSON.parse('{"prim":"Pair","args":[{"bytes":"'+t(s)+'"},{"prim":"Pair","args":[{"string":"'+e+'"},{"int":"'+n+'"}]}]}')}}]});if(a.transactionHash)return a.transactionHash}catch(e){console.log("ERROR reply(): "+JSON.stringify(e))}return!1}(s,i,a):n?await async function(e,n){if(!B())return console.log("ERROR update_msg(): "+L),!1;if(!N())return console.log("ERROR update_msg(): "+R),!1;try{if((await c.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:r,parameters:{entrypoint:"update_tweet",value:JSON.parse('{"prim":"Pair","args":[{"int":"'+n+'"},{"bytes":"'+t(e)+'"}]}')}}]})).transactionHash)return!0}catch(e){console.log("ERROR update_msg(): "+JSON.stringify(e))}return!1}(a,n):await async function(e){if(!B())return console.log("ERROR msg(): "+L),!1;if(!N())return console.log("ERROR msg(): "+R),!1;try{if((await c.requestOperation({operationDetails:[{kind:beacon.TezosOperationType.TRANSACTION,amount:0,destination:r,parameters:{entrypoint:"tweet",value:JSON.parse('{"prim":"Pair","args":[{"bytes":"'+t(e)+'"},{"prim":"Pair","args":[{"int":"0"},{"int": "0"}]}]}')}}]})).transactionHash)return!0}catch(e){console.log("ERROR msg(): "+JSON.stringify(e))}return!1}(a),e){if($(),s&&i&&!n){let e=document.getElementById("replyVal_"+s+"_"+i);if(e){let t=parseInt(e.innerHTML);e.innerHTML=isNaN(t)?1:t+1}}le()}}else bulmaToast.toast({type:"is-danger",message:"Message length has to be in ["+v.get(p)+".."+v.get(f)+"]"})}())),document.getElementById("bNewTweetClose").addEventListener("click",(()=>le())),document.getElementById("bNewTweetCancel").addEventListener("click",(()=>le())),document.getElementById("tNewTweet").addEventListener("keyup",(function(e){e.preventDefault(),27===e.keyCode&&le()})),document.getElementById("btnTweetLike").addEventListener("click",(()=>async function(){if(event.stopPropagation(),!N())return void bulmaToast.toast(z);let e=event.target.closest("nav"),t=e.getAttribute("data-username"),n=e.getAttribute("data-address"),s=e.getAttribute("data-mid");if(console.log("INFO doTweetLike(): like/unlike for username="+t+" address="+n+" id="+s),await U(t,s)){$();let e=document.getElementById("btnTweetLikeImg");if(e){let t=document.getElementById("likeVal_"+n+"_"+s);if(t){let n=parseInt(t.innerHTML);n=e.classList.contains("fa-regular")?isNaN(n)?1:n+1:isNaN(n)?0:n-1,t.innerHTML=n}e.classList.toggle("fa-regular"),e.classList.toggle("fa-solid")}}}())),document.getElementById("btnTweetReply").addEventListener("click",(()=>de())),document.getElementById("btnTweetRetweet").addEventListener("click",(()=>ce())),document.getElementById("btnTweetLink").addEventListener("click",(()=>ge())),LT=e})();